<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>SAE 1.03</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
  <style>
    body.dark-mode { background-color: #2e003e !important; color: #fff !important; }
    nav.dark-mode { background-color: #1c002b !important; }
    nav.dark-mode .navbar-brand, nav.dark-mode .nav-link { color: #fff !important; }
    body, nav { transition: background-color .4s ease, color .4s ease; }
    .scrollspy-example { height: 80vh; overflow-y: auto; position: relative; }
    #tocNav { position: sticky; top: 1rem; }
    code { background-color: #000; color: #ff0; padding: 2px 4px; border-radius: 4px; }
  </style>
</head>

<body class="dark-mode">
  <nav class="navbar navbar-expand-lg navbar-dark dark-mode py-3">
    <div class="container-fluid">
      <a class="navbar-brand fs-3 fw-bold" href="index.html">SAE 1.03</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarContent"
        aria-controls="navbarContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarContent">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item"><a class="nav-link" href="index.html">Accueil</a></li>
          <li class="nav-item"><a class="nav-link" href="semaines.html">Semaines</a></li>
          <li class="nav-item"><a class="nav-link active" href="questions.html">Questions</a></li>
        </ul>
      </div>
    </div>
  </nav>
  <div class="container py-5">
    <div class="row">
      <aside class="col-md-3">
        <nav id="tocNav" class="nav flex-column nav-pills">
          <a class="nav-link active" href="#semaine2">Semaine 2</a>
          <a class="nav-link" href="#semaine3">Semaine 3</a>
          <a class="nav-link" href="#semaine4">Semaine 4</a>
        </nav>
      </aside>
      <div class="col-md-9 scrollspy-example" data-bs-spy="scroll" data-bs-target="#tocNav" data-bs-offset="0" tabindex="0">
        <section class="mb-5" id="semaine2">
          <h2>Semaine 2</h2>
            <div id="carouselWeek2" class="carousel slide mb-3" data-bs-ride="carousel">
            <div class="carousel-indicators">
              <button type="button" data-bs-target="#carouselWeek2" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Screenshot 1"></button>
              <button type="button" data-bs-target="#carouselWeek2" data-bs-slide-to="1" aria-label="Screenshot 2"></button>
              <button type="button" data-bs-target="#carouselWeek2" data-bs-slide-to="2" aria-label="Screenshot 3"></button>
              <button type="button" data-bs-target="#carouselWeek2" data-bs-slide-to="3" aria-label="Screenshot 4"></button>
            </div>
            <div class="carousel-inner">
              <div class="carousel-item active">
              <img src="assets/img/part_1_1.png" class="d-block w-100" alt="Semaine 2 - Screenshot 1">
              <div class="carousel-caption d-none d-md-block">
                <h5>Installation Arch Linux</h5>
                <p>Configuration initiale sur VirtualBox</p>
              </div>
              </div>
              <div class="carousel-item">
              <img src="assets/img/part_1_2.png" class="d-block w-100" alt="Semaine 2 - Screenshot 2">
              <div class="carousel-caption d-none d-md-block">
                <h5>ArchInstall</h5>
                <p>Lancement de ArchInstall</p>
              </div>
              </div>
              <div class="carousel-item">
              <img src="assets/img/part_1_3.png" class="d-block w-100" alt="Semaine 2 - Screenshot 3">
              <div class="carousel-caption d-none d-md-block">
                <h5>Installation complète</h5>
                <p>Redémarage de la machine</p>
              </div>
              </div>
              <div class="carousel-item">
              <img src="assets/img/part_1_4.png" class="d-block w-100" alt="Semaine 2 - Screenshot 4">
              <div class="carousel-caption d-none d-md-block">
                <h5>Premier Démarrage</h5>
                <p>Connexion à la VM</p>
              </div>
              </div>
            </div>
            <button class="carousel-control-prev" type="button" data-bs-target="#carouselWeek2" data-bs-slide="prev">
              <span class="carousel-control-prev-icon" aria-hidden="true"></span>
              <span class="visually-hidden">Précédent</span>
            </button>
            <button class="carousel-control-next" type="button" data-bs-target="#carouselWeek2" data-bs-slide="next">
              <span class="carousel-control-next-icon" aria-hidden="true"></span>
              <span class="visually-hidden">Suivant</span>
            </button>
          </div>

          <p>
            Lors de cette deuxième semaine, nous avons choisi d'utiliser <strong>Arch Linux</strong>, car c'est l'OS que j'utilise déjà tous les jours. Pour le logiciel, nous avons choisi <strong>VirtualBox</strong>. Tout d'abord, nous avons installé l'image d'Arch Linux via un torrent en raison de ma connexion internet assez faible. Pour les paramètres de VirtualBox, nous avons utilisé <strong>8&nbsp;Go de RAM</strong> (sur les 48 que je possède), <strong>4&nbsp;cœurs de processeur</strong>, et <strong>128&nbsp;Mo de mémoire vidéo</strong>. Nous avions également dû changer le contrôleur graphique sur <code>VMSSVGA</code> car Arch ne supportait pas l'option par défaut.
          </p>
          <p>
            Nous avons ensuite sélectionné l'image et lancé la version par défaut de l'installeur. <strong>Arch Linux étant un OS sans interface graphique par défaut</strong>, nous avons dû l'installer manuellement de manière permanente sur le disque virtuel de la VM. Au départ, nous avons utilisé <code>loadkeys fr</code> pour sélectionner l'AZERTY pour le terminal, puis <code>archinstall</code> pour une installation plus simple et rapide. Dans les paramètres de <strong>ArchInstall</strong>, nous avons sélectionné la locale en <code>fr</code> et <code>fr_FR</code> supportant utf-8; pour la région miroir des serveurs et paquets, nous avons choisi tous les miroirs en France pour avoir une meilleure connexion internet.
          </p>
          <p>
            Pour la partition du disque, nous n'avons pas utilisé le paramétrage par défaut car celui‐ci est assez mauvais sur Arch. Nous avons créé <strong>deux partitions</strong>: une pour le boot ayant <strong>1&nbsp;Go</strong> et pointant vers <code>/boot</code> (pour le bootloader), puis le reste de la taille du disque vers <code>/</code>. Nous avons également utilisé le format <strong>btrfs</strong>, qui est bien meilleur pour certaines options, comme la création de sous‐volumes. Ici, nous en avons créés <strong>5</strong>: un ayant comme mountpoint <code>/</code>, un pour <code>/home</code>, un pour <code>/var/log</code>, un pour <code>/var/cache/pacman/pkg</code> et un pour les snapshots du système, vers <code>/.snapshots</code>. Cela permet, en cas d'échec ou de corruption d'un des volumes, de pouvoir plus facilement monter ou récupérer les données.
          </p>
          <p>
            Nous avons choisi <strong>grub</strong> comme bootloader par défaut, car c'est le seul qui est compatible de manière stable avec VirtualBox. Pour le nom d’hôte, nous avons opté pour quelque chose de reconnaissable sur mon réseau, <code>vm-arch-sae</code>. Nous avons activé l'utilisateur root, puis créé un utilisateur avec comme pseudo <code>raph9213</code>, étant un <strong>administrateur</strong> (en modifiant le fichier des sudoers). Pour les pilotes graphiques, nous avons utilisé ceux de <strong>NVIDIA</strong>, car ayant choisi <code>VMSVGA</code>, c’est la carte graphique directement reliée, et avec une carte NVIDIA c'était recommandé par Arch. Nous avons choisi un environnement <strong>KDE</strong>, plutôt proche de Windows et ayant quelques bénéfices lors de la corruption comparé à d'autres, et <strong>SDDM</strong> en greeter (celui recommandé pour KDE). Pour l'audio, nous avons choisi <code>pulseaudio</code>, plus récent. Pour le réseau, on utilisera <strong>NetworkManager</strong>, pour le configurer avec l'interface de KDE. 
          </p>
          <p>
            Pour le fuseau horaire, nous avons choisi <code>Europe/Paris</code>, puis nous avons commencé l'installation. L'installation a duré plus de <strong>20&nbsp;minutes</strong>. À la fin, nous avons exécuté la commande <code>reboot now</code> pour redémarrer la VM, nous avons déconnecté l'image virtuelle et nous nous sommes connectés à notre VM avec grub, qui a automatiquement trouvé l'installation d'Arch.
          </p>
          <button class="btn btn-secondary mt-3" data-bs-toggle="modal" data-bs-target="#commandsWeek2">
            Commandes Semaine 2
          </button>
        </section>
        <section class="mb-5" id="semaine3">
          <h2>Semaine 3</h2>
          <div id="carouselWeek3" class="carousel slide mb-3" data-bs-ride="carousel">
            <div class="carousel-indicators">
              <button type="button" data-bs-target="#carouselWeek3" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Screenshot 1"></button>
              <button type="button" data-bs-target="#carouselWeek3" data-bs-slide-to="1" aria-label="Screenshot 2"></button>
              <button type="button" data-bs-target="#carouselWeek3" data-bs-slide-to="2" aria-label="Screenshot 3"></button>
              <button type="button" data-bs-target="#carouselWeek3" data-bs-slide-to="3" aria-label="Screenshot 4"></button>
            </div>
            <div class="carousel-inner">
              <div class="carousel-item active">
              <img src="assets/img/part_2_1.png" class="d-block w-100" alt="Semaine 3 - Screenshot 1">
              <div class="carousel-caption d-none d-md-block">
                <h5>Paramètres initiaux</h5>
                <p>Installation de Firefox pour le web</p>
              </div>
              </div>
              <div class="carousel-item">
              <img src="assets/img/part_2_2.png" class="d-block w-100" alt="Semaine 3 - Screenshot 2">
              <div class="carousel-caption d-none d-md-block">
                <h5>Gestion des utilisateurs</h5>
                <p>Ajout des utilisateurs</p>
              </div>
              </div>
              <div class="carousel-item">
              <img src="assets/img/part_2_3.png" class="d-block w-100" alt="Semaine 3 - Screenshot 3">
              <div class="carousel-caption d-none d-md-block">
                <h5>Récupération du bashrc</h5>
                <p>Récupération via mon serveur</p>
              </div>
              </div>
              <div class="carousel-item">
              <img src="assets/img/part_2_4.png" class="d-block w-100" alt="Semaine 3 - Screenshot 4">
              <div class="carousel-caption d-none d-md-block">
                <h5>Prompt personnalisé</h5>
                <p>Uptime, date et shell actifs</p>
              </div>
              </div>
            </div>
            <button class="carousel-control-prev" type="button" data-bs-target="#carouselWeek3" data-bs-slide="prev">
              <span class="carousel-control-prev-icon" aria-hidden="true"></span>
              <span class="visually-hidden">Précédent</span>
            </button>
            <button class="carousel-control-next" type="button" data-bs-target="#carouselWeek3" data-bs-slide="next">
              <span class="carousel-control-next-icon" aria-hidden="true"></span>
              <span class="visually-hidden">Suivant</span>
            </button>
          </div>

          <p>
            Nouvelle semaine, utilisant <strong>Arch</strong>, nous avons quelques paramètres initiaux à faire. Tout d'abord, nous avons installé <strong>Firefox</strong> car nous allons créer un site web, puis nous avons récupéré le document sur cette VM. L'installateur de paquets par défaut sur Arch étant <code>pacman</code>, nous avons utilisé la commande <code>sudo pacman -S firefox</code>. Nous avons dû utiliser <strong>sudo</strong>, car pacman installe ces paquets dans <code>/var/cache/pacman/pkg</code> et dans <code>/bin</code> en lien symbolique, ce qui demande des permissions d'administrateur.
          </p>
          <p>
            Pour créer un compte sur Arch, nous utilisons la commande <code>useradd</code>, qui est assez complexe à utiliser. La commande pour créer un <strong>administrateur</strong> est <code>useradd -m -G wheel -s /bin/bash admin_Gr112_Binome05</code> (l'option <code>-G wheel</code> permet de l'ajouter en tant qu'admin, l'option <code>-m</code> de créer un dossier utilistateur dans <code>/home/username</code>, et <code>-s</code> de donner le shell par défaut, ici <code>/bin/bash</code>). Ensuite, Arch demande que tout administrateur ou personne ayant des paramètres de <strong>sudo</strong> ait un mot de passe pour des raisons de sécurité, nous avons utilisé la commande <code>sudo passwd admin_Gr112_Binome05</code> et ajouté un mot de passe à celui‐ci. Pour vérifier que nous avons bien créé l'utilisateur, nous avons utilisé la commande <code>su - admin_Gr112_Binome05</code>, ce qui a fonctionné (on peut le voir avec la commande <code>who</code>).
          </p>
          <p>
            Pour créer <strong>deux utilisateurs sans permission d'administration</strong>, il nous suffit de retirer <code>-G wheel</code>. Nous avons donc fait les commandes <code>sudo useradd -m -s /bin/bash Binome05_1</code> et <code>sudo useradd -m -s /bin/bash Binome05_2</code>. Pour créer un groupe, nous utilisons la commande <code>sudo groupadd Binome05</code>, puis pour ajouter les deux utilisateurs au groupe, nous utilisons la commande <code>sudo usermod -aG Binome05 Binome05_1</code> et <code>sudo usermod -aG Binome05 Binome05_2</code>.
          </p>
          <p>
            La dernière tâche de cette semaine était de modifier le <strong>prompt du terminal</strong> avec le nom de l'utilisateur. Pour modifier celui‐ci, nous devons éditer le fichier <code>~/.bashrc</code> pour notre utilisateur, lequel contient une grande partie des paramètres de notre terminal (comme certains alias), et surtout la définition de la variable d'environnement <code>PS1</code>, qui va nous permettre de modifier notre prompt. Ayant mon propre serveur, j'ai récupéré celui que j'utilise d'habitude. Je me suis ainsi connecté à mon serveur en utilisant <strong>sftp</strong> avec la commande <code>sftp root@&lt;ip de mon serveur&gt;</code>, ayant une <strong>clé SSH privée</strong> pour me connecter à mon serveur, j'ai dû la récupérer et la mettre dans <code>~/.ssh</code>, et modifier les permissions de celle‐ci pour que tout le monde ne puisse pas la voir, avec <code>chmod 700 ~/.ssh/id_rsa</code>. Pour récupérer mes paramètres via sftp, j'ai utilisé dans sftp la commande <code>get /root/.bashrc</code>, puis j'ai déplacé ce fichier dans <code>~/.bashrc</code>. J'ai enfin rechargé les paramètres de mon terminal pour afficher le résultat avec la commande <code>source ~/.bashrc</code>. 
          </p>
          <p>
            Pour m'amuser davantage, j'ai modifié mon prompt pour avoir un <strong>maximum d'informations</strong> dedans. J'ai utilisé la commande <code>export PS1="\u@\h [\w] \d \t (Uptime: $(uptime)) [Jobs: \j] [Shell: $0]\n\$ "</code>, permettant d'exporter la variable d'environnement <strong>PS1</strong> (responsable du prompt par défaut) pour y inclure la date, l'uptime de la machine, le nombre de jobs en cours et le shell actif. Et c'est ce qui conclut cette semaine 3.
          </p>
          <button class="btn btn-secondary mt-3" data-bs-toggle="modal" data-bs-target="#commandsWeek3">
            Commandes Semaine 3
          </button>
        </section>
        <section class="mb-5" id="semaine4">
          <h2>Semaine 4</h2>

          <div id="carouselWeek4" class="carousel slide mb-3" data-bs-ride="carousel">
            <div class="carousel-indicators">
                <button type="button" data-bs-target="#carouselWeek4" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Screenshot 1"></button>
                <button type="button" data-bs-target="#carouselWeek4" data-bs-slide-to="1" aria-label="Screenshot 2"></button>
                <button type="button" data-bs-target="#carouselWeek4" data-bs-slide-to="2" aria-label="Screenshot 3"></button>
                <button type="button" data-bs-target="#carouselWeek4" data-bs-slide-to="3" aria-label="Screenshot 4"></button>
                <button type="button" data-bs-target="#carouselWeek4" data-bs-slide-to="4" aria-label="Screenshot 5"></button>
                <button type="button" data-bs-target="#carouselWeek4" data-bs-slide-to="5" aria-label="Screenshot 6"></button>
                <button type="button" data-bs-target="#carouselWeek4" data-bs-slide-to="6" aria-label="Screenshot 7"></button>
                <button type="button" data-bs-target="#carouselWeek4" data-bs-slide-to="7" aria-label="Screenshot 8"></button>
                <button type="button" data-bs-target="#carouselWeek4" data-bs-slide-to="8" aria-label="Screenshot 9"></button>
                <button type="button" data-bs-target="#carouselWeek4" data-bs-slide-to="9" aria-label="Screenshot 10"></button>
              </div>
              <div class="carousel-inner">
                <div class="carousel-item active">
                <img src="assets/img/part_3_1.png" class="d-block w-100" alt="Semaine 4 - Screenshot 1">
                <div class="carousel-caption d-none d-md-block">
                  <h5>Installation d'un serveur Apache2</h5>
                  <p>Installation d'apache via httpd</p>
                </div>
                </div>
                <div class="carousel-item">
                <img src="assets/img/part_3_2.png" class="d-block w-100" alt="Semaine 4 - Screenshot 2">
                <div class="carousel-caption d-none d-md-block">
                  <h5>Vérification du serveur web</h5>
                  <p>Vérification avec curl</p>
                </div>
                </div>
                <div class="carousel-item">
                <img src="assets/img/part_3_3.png" class="d-block w-100" alt="Semaine 4 - Screenshot 3">
                <div class="carousel-caption d-none d-md-block">
                  <h5>Configuration du DocumentRoot</h5>
                  <p>Modification du fichier httpd.conf</p>
                </div>
                </div>
                <div class="carousel-item">
                <img src="assets/img/part_3_4.png" class="d-block w-100" alt="Semaine 4 - Screenshot 4">
                <div class="carousel-caption d-none d-md-block">
                  <h5>Vérification du DocumentRoot</h5>
                  <p>Via la commande nano</p>
                </div>
                </div>
                <div class="carousel-item">
                <img src="assets/img/part_3_5.png" class="d-block w-100" alt="Semaine 4 - Screenshot 5">
                <div class="carousel-caption d-none d-md-block">
                  <h5>Création du serveur git</h5>
                  <p>Utilisation de GitHub CLI</p>
                </div>
                </div>
                <div class="carousel-item">
                <img src="assets/img/part_3_6.png" class="d-block w-100" alt="Semaine 4 - Screenshot 6">
                <div class="carousel-caption d-none d-md-block">
                  <h5>Pull des modifications</h5>
                  <p>Synchronisation avec GitHub</p>
                </div>
                </div>
                <div class="carousel-item">
                <img src="assets/img/part_3_7.png" class="d-block w-100" alt="Semaine 4 - Screenshot 7">
                <div class="carousel-caption d-none d-md-block">
                  <h5>Verification finale</h5>
                  <p>Pulls récupéré depuis le serveur git !</p>
                </div>
                </div>
                <div class="carousel-item">
                <img src="assets/img/part_3_8.png" class="d-block w-100" alt="Semaine 4 - Screenshot 8">
                <div class="carousel-caption d-none d-md-block">
                  <h5>Création du cronjob</h5>
                  <p>Ajout de l'automatisation des pulls</p>
                </div>
                </div>
                <div class="carousel-item">
                <img src="assets/img/part_3_9.jpg" class="d-block w-100" alt="Semaine 4 - Screenshot 9">
                <div class="carousel-caption d-none d-md-block">
                  <h5>Ajout de la redirectiond des ports depuis la VM</h5>
                  <p>Depuis 80 vers 80</p>
                </div>
                </div>
                <div class="carousel-item">
                <img src="assets/img/part_3_10.png" class="d-block w-100" alt="Semaine 4 - Screenshot 10">
                <div class="carousel-caption d-none d-md-block">
                  <h5>Vérification finale !</h5>
                  <p>Le cronjob fonctionne !</p>
                </div>
                </div>
              </div>
            <button class="carousel-control-prev" type="button" data-bs-target="#carouselWeek4" data-bs-slide="prev">
              <span class="carousel-control-prev-icon" aria-hidden="true"></span>
              <span class="visually-hidden">Précédent</span>
            </button>
            <button class="carousel-control-next" type="button" data-bs-target="#carouselWeek4" data-bs-slide="next">
              <span class="carousel-control-next-icon" aria-hidden="true"></span>
              <span class="visually-hidden">Suivant</span>
            </button>
          </div>

          <p>
            Installation d'un <strong>serveur</strong> durant cette semaine : nous avons décidé d'utiliser <strong>apache2</strong>, car c'est celui que j'utilise depuis plusieurs années sur mon serveur et dont j'ai le plus d'expérience. L'installation de <strong>Apache</strong> sur Arch est un peu différente, car apache utilise <code>httpd</code> derrière le logiciel (uniquement sur Arch). Nous avons récupéré l'emplacement du <em>DocumentRoot</em> dans <code>/etc/httpd/conf/httpd.conf</code>, avec la commande <code>nano /etc/httpd/conf/httpd.conf</code>. Nous sommes ensuite allés dans notre DocumentRoot, ici <code>/srv/http</code>. 
          </p>
          <p>
            Pour activer le processus, nous avons fait <code>sudo systemctl enable httpd.service</code> puis <code>sudo systemctl start httpd.service</code>, créant et lançant le <strong>serveur web</strong> sur le serveur, et ce à chaque redémarrage. Nous avons ensuite vérifié avec <code>curl http://localhost/</code>, qui affichait ainsi l'index de <code>/srv/http</code> sur le site. Nous avons ensuite créé un fichier de test avec <code>echo "&lt;h1&gt;Test Server&lt;/h1&gt;" &gt;&gt; index.html</code>, puis revérifié avec <code>curl</code> si celui‐ci a bien été mis à jour : c'est le cas, notre serveur web est donc en ligne et fonctionnel !
          </p>
          <p>
            Pour le développement, nous avons décidé d'utiliser un <strong>serveur Git</strong>, ici <strong>GitHub</strong>, pour pouvoir effectuer des changements sur nos ordinateurs, et que ceux‐ci soient modifiés directement sur le site. Pour une installation plus simple, nous utilisons <code>github-cli</code>, qui permet d'être connecté à notre GitHub sans gérer des clés SSH à foison. Nous installons GitHub CLI avec <code>sudo pacman -S github-cli</code>, puis nous nous connectons avec <code>gh auth login</code>. Nous utiliserons un <strong>token d'autorisation</strong>, car bien plus simple pour se connecter depuis son propre ordinateur. Sur <a href="https://github.com/settings/token" target="_blank">https://github.com/settings/token</a>, nous créons ainsi un token : il nous faut au moins la permission <strong>repo</strong> pour lire des repos privés, le reste des permissions n'est pas obligatoire, mais recommandé. Après avoir collé notre token d'autorisation dans GitHub CLI, nous pouvons commencer. <strong>Git</strong> est par défaut installé avec Arch, nous pouvons donc créer le repo. 
          </p>
          <p>
            Pour commencer, on va dans le dossier <code>/srv/http</code>, puis nous utilisons <code>git remote -v</code> pour vérifier qu'aucun lien git n'est actuellement en cours dans ce dossier, puis nous créons un nouveau repo avec GitHub CLI grâce à la commande <code>gh repo create sae_system_web --private --source=. --remote=github</code>. Les options ici sont <code>--private</code> pour créer un dépôt privé, <code>--source=.</code> pour indiquer que le lien sera fait dans notre dossier courant (ici <code>/srv/http</code>, soit le DocumentRoot), et enfin nous indiquons que la source distante sur le repo est nommée <code>github</code>.
          </p>
          <p>
            Sur nos ordinateurs personnels, on utilise <strong>Visual Studio Code</strong>, pour pouvoir gérer le repo GitHub; nous utiliserons <strong>GitHub Desktop</strong>. Au départ, nous créons un simple fichier HTML nommé <code>index.html</code> dans le repo git, puis nous le pushons depuis nos ordinateurs personnels. Ensuite, sur la VM, nous utilisons la commande <code>git reset --hard github/main</code> pour supprimer tout fichier superflu de notre dossier qui ne serait pas sur notre git, puis nous utilisons <code>git pull github main --allow-unrelated-histories</code> pour “pull” le repo depuis GitHub, récupérant ainsi le fichier créé sur notre ordinateur vers notre VM. Nous utilisons <code>curl</code> pour fetch la modification : la modification est effectuée, le serveur réagit bien aux modifications de repo Git !
          </p>
          <p>
            Pour revérifier, on peut modifier de nouveau notre fichier sur notre ordinateur local, push la modification sur le git, puis ré‐effectuer la commande <code>git pull github main --allow-unrelated-histories</code>, et on constate que le fichier est encore une fois mis à jour ! Maintenant, il faudrait que le serveur exécute la commande sans qu'on l'effectue manuellement, pour que le serveur soit toujours à jour avec le repo Git ! Nous avons choisi de créer un <strong>cronjob</strong>, fonctionnalité de nombreux systèmes permettant d'exécuter une commande toutes les X minutes, parfait dans notre cas. Nous installons <code>cronie</code> (permettant d'utiliser des cronjobs sur Arch) avec <code>sudo pacman -S cronie</code>, puis en l'activant via <code>sudo systemctl enable cronie</code> et <code>sudo systemctl start cronie</code>.
          </p>
          <p>
            La création d'un cronjob est un peu spéciale. Tout d'abord, nous indiquons que notre éditeur de texte principal de notre machine est <strong>nano</strong> avec <code>export EDITOR=nano</code>, puis nous utilisons <code>crontab -e</code> pour créer le job. Dans le nouveau fichier, nous marquons <code>* * * * * cd /srv/http &amp;&amp; git pull github main &gt;&gt; /home/raph9213/github_log.log 2&gt;&amp;1</code>. Cette très longue chaîne de caractères indique que toutes les minutes (<code>* * * * *</code>) la commande <code>cd /srv/http &amp;&amp; git pull github main &gt;&gt; /home/raph9213/github_log.log 2&gt;&amp;1</code> sera exécutée, permettant d'aller dans le bon dossier, de pull les modifications du repo GitHub et d’indiquer les logs et erreurs dans un fichier <code>github_log.log</code>. Enfin, on fait une <strong>courte vérification</strong> : cela fonctionne !
          </p>
          <p>
            Pour une dernière modification, étant donné que c’est une VM sur ma machine, <strong>VirtualBox</strong> autorise la <strong>redirection de certains ports</strong> de la VM sur mon ordinateur local : je redirige le port virtuel <code>80</code> vers le port <code>80</code> de mon ordinateur pour vérifier si le site web fonctionne. J'ouvre un nouvel onglet sur <code>localhost/</code> et je vois que le site web, géré sur le serveur web de la VM, est bien activé sur mon ordinateur. Enfin, nous pouvons configurer <strong>Visual Studio Code</strong> (ou n'importe quel autre IDE) pour utiliser le repo GitHub à chaque changement, permettant ainsi que n'importe quelle modification effectuée sur mon ordinateur et poussée sur GitHub soit redirigée vers la VM. C'est la fin de cette <strong>semaine 4</strong>, assez longue, mais très importante !
          </p>
          <button class="btn btn-secondary mt-3" data-bs-toggle="modal" data-bs-target="#commandsWeek4">
            Commandes Semaine 4
          </button>
        </section>
      </div>
    </div>
    <div class="text-center mt-3">
      <h3>Navigation</h3>
      <div class="btn-group btn-group-lg mt-3" role="group">
        <a href="index.html" class="btn btn-warning">Retour Accueil</a>
        <a href="questions.html" class="btn btn-success">Questions</a>
      </div>
    </div>

  </div>
  <div class="modal fade" id="commandsWeek2" tabindex="-1" aria-labelledby="commandsWeek2Label" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content bg-dark text-light">
        <div class="modal-header">
          <h5 class="modal-title" id="commandsWeek2Label">Commandes Semaine 2</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <p class="mb-3">Principales commandes pour l'installation d'<strong>Arch Linux</strong>, la configuration <strong>Btrfs</strong> et le setup <strong>VirtualBox</strong>.</p>
          <div class="bg-dark text-light p-3 rounded">
<pre>
<b>loadkeys fr</b>
# Sélection du clavier AZERTY pour le terminal

<b>archinstall</b>
# Installe Arch Linux via un script simplifié
# Locale: fr / fr_FR
# Partitions Btrfs: /boot (1GB), / (restant), plus sous-volumes

<b>reboot now</b>
# Redémarrer la VM, grub détecte l’installation
</pre>
          </div>
          <p class="mb-0">Nous avons aussi paramétré le <strong>hostname</strong> sur <code>vm-arch-sae</code>, activé <strong>root</strong>, et créé l’utilisateur <code>raph9213</code> comme <strong>administrateur (sudoers)</strong>.</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fermer</button>
        </div>
      </div>
    </div>
  </div>
  <div class="modal fade" id="commandsWeek3" tabindex="-1" aria-labelledby="commandsWeek3Label" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content bg-dark text-light">
        <div class="modal-header">
          <h5 class="modal-title" id="commandsWeek3Label">Commandes Semaine 3</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <p class="mb-3">Création des comptes, installation de <strong>Firefox</strong>, et personnalisation du <strong>prompt</strong>.</p>
          <div class="bg-dark text-light p-3 rounded">
<pre>
<b>sudo pacman -S firefox</b>
# Installe Firefox (pacman nécessite sudo)

<b>useradd -m -G wheel -s /bin/bash admin_Gr112_Binome05</b>
# -m : crée un home directory
# -G wheel : accorde les droits sudo
# -s /bin/bash : shell par défaut

<b>sudo passwd admin_Gr112_Binome05</b>
# Définit son mot de passe

<b>su - admin_Gr112_Binome05</b>
# Vérifie l’utilisateur
<b>who</b>
# Vérifie qui est connecté

<b>sudo useradd -m -s /bin/bash Binome05_1</b>
<b>sudo useradd -m -s /bin/bash Binome05_2</b>
# Création de 2 utilisateurs sans droit admin

<b>sudo groupadd Binome05</b>
# Nouveau groupe
<b>sudo usermod -aG Binome05 Binome05_1</b>
<b>sudo usermod -aG Binome05 Binome05_2</b>
# Ajout des utilisateurs au groupe

<b>chmod 700 ~/.ssh/id_rsa</b>
# Sécurise la clé privée SSH

<b>get /root/.bashrc</b> (via sftp)
# Rapatrie le .bashrc du serveur distant

<b>source ~/.bashrc</b>
# Recharge le prompt
<b>export PS1="...etc..."</b>
# Personnalise le prompt (date, uptime, shell)
</pre>
          </div>
          <p class="mb-0">Ainsi, nous avons un <strong>nouvel admin</strong>, deux users standards, et un <strong>prompt personnalisé</strong>.</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fermer</button>
        </div>
      </div>
    </div>
  </div>
  <div class="modal fade" id="commandsWeek4" tabindex="-1" aria-labelledby="commandsWeek4Label" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content bg-dark text-light">
        <div class="modal-header">
          <h5 class="modal-title" id="commandsWeek4Label">Commandes Semaine 4</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <p class="mb-3">Installation d’<strong>Apache (httpd)</strong>, configuration de <strong>GitHub CLI</strong>, et mise en place d’un <strong>cronjob</strong> pour le pull automatique.</p>
          <div class="bg-dark text-light p-3 rounded">
<pre>
<b>sudo systemctl enable httpd.service</b>
<b>sudo systemctl start httpd.service</b>
# Active et lance le serveur Apache

<b>curl http://localhost/</b>
# Vérifie la page index (DocumentRoot /srv/http)

<b>echo "Test Server" >> index.html</b>
# Ajoute un contenu simple à l’index

<b>sudo pacman -S github-cli</b>
# Installe GitHub CLI pour gérer le repo
<b>gh auth login</b>
# Connection à GitHub (token)

<b>gh repo create sae_system_web --private --source=. --remote=github</b>
# Crée un repo privé, rattache /srv/http

<b>git reset --hard github/main</b>
# Supprime tout fichier hors repo
<b>git pull github main --allow-unrelated-histories</b>
# Récupère la branche main (même si historique non lié)

<b>sudo pacman -S cronie</b>
# Installe le service cron sur Arch
<b>sudo systemctl enable cronie && sudo systemctl start cronie</b>
# Active et lance cron

<b>crontab -e</b>
# Edite la table de cronjobs
<b>* * * * * cd /srv/http && git pull github main >> /home/raph9213/github_log.log 2>&1</b>
# Tâche exécutée chaque minute
</pre>
          </div>
          <p class="mb-0">Enfin, on redirige le <strong>port 80</strong> de la VM vers la machine locale dans <strong>VirtualBox</strong> et on peut accéder au site via <code>localhost</code> directement.</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fermer</button>
        </div>
      </div>
    </div>
  </div>
</body>
</html>
